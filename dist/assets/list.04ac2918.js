var H=Object.defineProperty,O=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var I=(e,o,r)=>o in e?H(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,w=(e,o)=>{for(var r in o||(o={}))K.call(o,r)&&I(e,r,o[r]);if(U)for(var r of U(o))Z.call(o,r)&&I(e,r,o[r]);return e},B=(e,o)=>O(e,j(o));import{d as G}from"./dayjs.644349ef.js";import{a as J,b as X,i as $,g as ee,c as te,d as oe}from"./message.dd992364.js";import{s as x,_ as S}from"./index.5b82d3e6.js";import{u as ae}from"./UseSearch.32a49bf2.js";import{u as le,a as ne,b as se}from"./UseDialog.7d7ff299.js";import{F as R}from"./index.a901fab7.js";import{m as re}from"./smsTemplate.b0c6c2ce.js";import{b as N,c as ie}from"./element-plus.55dd86f2.js";import{r as g,f as M,Z as s,o as b,K as v,L as a,a as z,T as l,c as A,a2 as E,F as Q,R as D,_ as me,S as ce,Q as F}from"./@vue.9f1b68af.js";import{Q as de}from"./@element-plus.a205db37.js";import"./axios.8b958ab2.js";import"./vue-router.949634a5.js";import"./vuex.49683c05.js";import"./moment.a5c37c1e.js";import"./js-cookie.31874410.js";import"./nprogress.2f56b1fe.js";import"./lodash-es.3d1d9723.js";import"./@vueuse.ef512f30.js";import"./@popperjs.da6c49cb.js";import"./@ctrl.2e36ce53.js";import"./async-validator.5d25c98b.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";function ue(e){return x({url:"common/download",method:"get",responseType:"blob",params:e})}function pe(e){return x({url:"sms/task/import",method:"post",data:e})}const fe=[{label:"\u5E8F\u53F7",type:"index",width:"100px"},{label:"\u540D\u79F0",prop:"name"},{label:"\u72B6\u6001",prop:"status",render:e=>({0:"\u5F85\u6267\u884C",1:"\u5DF2\u7EC8\u6B62",2:"\u6267\u884C\u4E2D",3:"\u5DF2\u5B8C\u6210"})[e.status]},{label:"\u53F7\u7801\u6570",prop:"total"},{label:"\u5DF2\u5B8C\u6210\u6570",prop:"done"},{label:"\u521B\u5EFA\u4EBA",prop:"creatorName"},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"",render:e=>G(e.createdAt).format("YYYY-MM-DD HH:mm:ss")},{label:"\u64CD\u4F5C",prop:"operation",slot:"operation"}],_e={props:{value:{type:Boolean,default:!1},type:{type:String,default:""},defaultForm:{type:Object,default:()=>({})}},components:{FileUpload:R},emits:["cancel","confirm"],setup(e,{emit:o}){const r=g(null),t=g(!1),k={defaultForm:w({name:"",templateId:""},e.defaultForm),defaultRules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",trigger:"change"}],templateId:[{required:!0,message:"\u8BF7\u9009\u62E9\u77ED\u4FE1\u6A21\u7248",trigger:"change"}]},confirm:n=>{if(t.value)return;const i=n.id?"\u7F16\u8F91\u6210\u529F":"\u65B0\u589E\u6210\u529F",c=n.id?J:X;u.value=!1;const{templateId:V,name:p}=n,T={templateId:V,name:p};n.id&&(T.id=n.id),c(T).then(q=>{t.value=!1,N({type:"success",message:i,duration:1e3}),o("confirm")})},cancel:()=>{u.value=!1,o("cancel")}};M(()=>e.defaultForm,n=>{n&&_(),y.setForm(w({name:"",templateId:""},n))});const y=le(r,k),{getTitle:d,visible:u}=ne(e,{create:"\u65B0\u589E",edit:"\u7F16\u8F91"}),f=g([]),C=g(!1),_=()=>{re({status:1}).then(i=>{f.value=i.data})};return _(),w({visible:u,title:d,formRef:r,btnLoading:t,msgTplList:f,getMsgTplListAll:_,loading:C},y)}},ge={class:"dialog-footer"},be=D("\u53D6\u6D88"),he=D(" \u786E\u5B9A ");function ye(e,o,r,t,k,y){const d=s("el-input"),u=s("el-form-item"),f=s("el-option"),C=s("el-select"),_=s("el-form"),n=s("el-button"),i=s("el-dialog");return b(),v(i,{modelValue:t.visible,"onUpdate:modelValue":o[2]||(o[2]=c=>t.visible=c),title:t.title,"before-close":e.handleCancel},{footer:a(()=>[z("span",ge,[l(n,{onClick:e.handleCancel},{default:a(()=>[be]),_:1},8,["onClick"]),l(n,{type:"primary",loading:t.btnLoading,onClick:e.handleConfirm},{default:a(()=>[he]),_:1},8,["loading","onClick"])])]),default:a(()=>[l(_,{ref:"formRef",model:e.form,rules:e.rules,"label-width":"95px"},{default:a(()=>[l(u,{label:"\u4EFB\u52A1\u540D\u79F0:",prop:"name"},{default:a(()=>[l(d,{modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=c=>e.form.name=c),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(u,{label:"\u77ED\u4FE1\u6A21\u7248:",prop:"templateId"},{default:a(()=>[l(C,{modelValue:e.form.templateId,"onUpdate:modelValue":o[1]||(o[1]=c=>e.form.templateId=c),placeholder:"\u8BF7\u9009\u62E9\u77ED\u4FE1\u6A21\u7248",style:{width:"100%"}},{default:a(()=>[(b(!0),A(Q,null,E(t.msgTplList,c=>(b(),v(f,{key:c.id,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","before-close"])}var Ce=S(_e,[["render",ye]]);const ve={props:{visible:{type:Boolean,default:!1},id:{type:Number,default:0}},setup(e,o){const r=g(e.visible),t=g([]),k=g(0),y=g(0),d=me({pageNumber:1,pageSize:10}),u=()=>{const n=w({taskId:k.value},d);$(n).then(i=>{const{rows:c,total:V}=i;t.value=c,y.value=V})};return M(()=>e,()=>{const{visible:n,id:i}=e;r.value=n,k.value=i,n&&i&&u()},{immediate:!0,deep:!0}),{show:r,tableData:t,query:d,pageTotal:y,statusName:n=>({0:"\u5F85\u6267\u884C",1:"\u5DF2\u5B8C\u6210",2:"\u5DF2\u7EC8\u6B62"})[n],handleCurrentPage:n=>{d.pageNumber=n},handleCancel:()=>{o.emit("cancel",!1)}}}};function ke(e,o,r,t,k,y){const d=s("el-table-column"),u=s("el-table"),f=s("el-pagination"),C=s("el-dialog");return b(),v(C,{modelValue:t.show,"onUpdate:modelValue":o[0]||(o[0]=_=>t.show=_),title:"\u5BFC\u5165\u6587\u4EF6\u8BE6\u60C5","before-close":t.handleCancel},{default:a(()=>[l(u,{data:t.tableData,border:"",style:{width:"100%"}},{default:a(()=>[l(d,{align:"center",label:"\u59D3\u540D",prop:"name"}),l(d,{align:"center",label:"\u7535\u8BDD",prop:"tel"}),l(d,{align:"center",label:"\u72B6\u6001"},{default:a(_=>[D(ce(t.statusName(_.row.done)),1)]),_:1})]),_:1},8,["data"]),l(f,{onCurrentChange:t.handleCurrentPage,currentPage:t.query.pageNum,"page-size":t.query.pageSize,layout:"prev, pager, next",total:t.pageTotal},null,8,["onCurrentChange","currentPage","page-size","total"])]),_:1},8,["modelValue","before-close"])}var Te=S(ve,[["render",ke]]);const De={components:{CreateDialog:Ce,DetailDialog:Te,Download:de,FileUpload:R},setup(){const e=g(null),o=g({name:"",status:""}),{toQuery:r,clearForm:t}=ae(o,e),k=se(r),y=[{value:0,label:"\u5F85\u6267\u884C"},{value:2,label:"\u6267\u884C\u4E2D"},{value:1,label:"\u5DF2\u7EC8\u6B62"},{value:3,label:"\u5DF2\u5B8C\u6210"}],d=(p,T)=>{const q=p==="start"?"\u786E\u5B9A\u542F\u52A8\u8BE5\u4EFB\u52A1\uFF1F":"\u786E\u5B9A\u7EC8\u6B62\u8BE5\u4EFB\u52A1\uFF1F",P=p==="start"?"\u542F\u52A8\u6210\u529F":"\u7EC8\u6B62\u6210\u529F",L=p==="start"?te:oe;ie.confirm(q,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(()=>{L(T).then(()=>{N({type:"success",message:P,duration:1e3}),r()})})},u=()=>{ue({fileName:"/template.xlsx"}).then(T=>{})},f=g(null),C=p=>{if(p&&f.value){const T={id:f.value,filePath:p};pe(T).then(()=>{N({type:"success",message:"\u5BFC\u5165\u6587\u4EF6\u6210\u529F\uFF01",duration:1e3}),r()})}},_=p=>{f.value=p},n=g(!1),i=g(0),c=p=>{n.value=!0,i.value=p},V=()=>{n.value=!1};return B(w({basicTableRef:e,queryParams:o,getTaskList:ee,columns:fe,statusList:y,toQuery:r,clearForm:t},k),{handleDownload:u,handleTask:d,updateFile:C,handleUpload:_,detailVisible:n,detailId:i,handleDetail:c,handleClose:V})}},Ve={class:"flex-box flex-between"},we=D(" + \u65B0\u5EFA"),Fe=D(" \u5BFC\u51FA\u6587\u4EF6/\u6A21\u7248 "),qe=D(" \u8BE6\u60C5 "),Pe=D(" \u7F16\u8F91 "),Le=D(" \u542F\u52A8 "),Ne=D(" \u7EC8\u6B62 ");function Se(e,o,r,t,k,y){const d=s("el-input"),u=s("el-form-item"),f=s("el-col"),C=s("el-option"),_=s("el-select"),n=s("SearchWrap"),i=s("el-button"),c=s("download"),V=s("el-icon"),p=s("FileUpload"),T=s("BasicTable"),q=s("ListContainer"),P=s("CreateDialog"),L=s("DetailDialog"),W=s("PageWrapper");return b(),v(W,null,{default:a(()=>[l(n,{onReset:t.clearForm,onSearch:t.toQuery,model:t.queryParams},{default:a(({colSpan:m})=>[l(f,{span:m},{default:a(()=>[l(u,{label:"\u4EFB\u52A1\u540D\u79F0:"},{default:a(()=>[l(d,{modelValue:t.queryParams.name,"onUpdate:modelValue":o[0]||(o[0]=h=>t.queryParams.name=h),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:2},1032,["span"]),l(f,{span:m},{default:a(()=>[l(u,{label:"\u72B6\u6001:"},{default:a(()=>[l(_,{modelValue:t.queryParams.status,"onUpdate:modelValue":o[1]||(o[1]=h=>t.queryParams.status=h),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001"},{default:a(()=>[(b(!0),A(Q,null,E(t.statusList,(h,Y)=>(b(),v(C,{key:Y,value:h.value,label:h.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:2},1032,["span"])]),_:1},8,["onReset","onSearch","model"]),l(q,null,{default:a(()=>[l(T,{columns:t.columns,queryApi:t.getTaskList,queryParams:t.queryParams,ref:"basicTableRef"},{tableHeader:a(()=>[z("div",Ve,[l(i,{type:"primary",onClick:o[2]||(o[2]=m=>e.handleOperationClick("create"))},{default:a(()=>[we]),_:1}),l(i,{type:"primary",onClick:t.handleDownload},{default:a(()=>[l(V,{size:"14px"},{default:a(()=>[l(c)]),_:1}),Fe]),_:1},8,["onClick"])])]),operation:a(({data:m})=>[m.total?(b(),v(i,{key:0,type:"text",onClick:h=>t.handleDetail(m.id)},{default:a(()=>[qe]),_:2},1032,["onClick"])):F("",!0),m.total==m.done?(b(),v(i,{key:1,type:"text",onClick:h=>t.handleUpload(m.id)},{default:a(()=>[l(p,{buttonType:"text",isShowTip:!1,onUpdateFile:t.updateFile},null,8,["onUpdateFile"])]),_:2},1032,["onClick"])):F("",!0),m.status==0?(b(),v(i,{key:2,type:"text",onClick:h=>e.handleOperationClick("edit",m)},{default:a(()=>[Pe]),_:2},1032,["onClick"])):F("",!0),m.total&&m.total!==m.done&&(m.status==0||m.status==1)?(b(),v(i,{key:3,type:"text",onClick:h=>t.handleTask("start",m.id)},{default:a(()=>[Le]),_:2},1032,["onClick"])):F("",!0),m.status==2?(b(),v(i,{key:4,type:"text",style:{color:"#f56c6c"},onClick:h=>t.handleTask("stop",m.id)},{default:a(()=>[Ne]),_:2},1032,["onClick"])):F("",!0)]),_:1},8,["columns","queryApi","queryParams"])]),_:1}),l(P,{value:e.showDialog,type:e.typeDialog,defaultForm:e.defaultForm,onCancel:e.handleCancel,onConfirm:e.handleConfirm},null,8,["value","type","defaultForm","onCancel","onConfirm"]),l(L,{visible:t.detailVisible,id:t.detailId,onCancel:t.handleClose},null,8,["visible","id","onCancel"])]),_:1})}var lt=S(De,[["render",Se]]);export{lt as default};
